"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[2417],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return g}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=u(n),g=a,p=m["".concat(s,".").concat(g)]||m[g]||d[g]||i;return n?r.createElement(p,o(o({ref:t},c),{},{components:n})):r.createElement(p,o({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},857:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return m}});var r=n(87462),a=n(63366),i=(n(67294),n(3905)),o=["components"],l={title:"Architecture"},s=void 0,u={unversionedId:"modules/agent/architecture",id:"modules/agent/architecture",isDocsHomePage:!1,title:"Architecture",description:"1 Overview of InLong-Agent",source:"@site/docs/modules/agent/architecture.md",sourceDirName:"modules/agent",slug:"/modules/agent/architecture",permalink:"/docs/next/modules/agent/architecture",editUrl:"https://github.com/apache/incubator-inlong-website/edit/master/docs/modules/agent/architecture.md",tags:[],version:"current",frontMatter:{title:"Architecture"},sidebar:"tutorialSidebar",previous:{title:"Build && Deployment",permalink:"/docs/next/modules/website/quick_start"},next:{title:"Build && Deployment",permalink:"/docs/next/modules/agent/quick_start"}},c=[{value:"1 Overview of InLong-Agent",id:"1-overview-of-inlong-agent",children:[{value:"1.1 The brief architecture diagram is as follows:",id:"11-the-brief-architecture-diagram-is-as-follows",children:[]},{value:"1.2 design concept",id:"12-design-concept",children:[]},{value:"1.3 Current status of use",id:"13-current-status-of-use",children:[]}]},{value:"2 InLong-Agent architecture",id:"2-inlong-agent-architecture",children:[]},{value:"3 Different kinds of agent",id:"3-different-kinds-of-agent",children:[{value:"3.1 file agent",id:"31-file-agent",children:[]},{value:"3.2 sql agent",id:"32-sql-agent",children:[]},{value:"3.3 binlog agent",id:"33-binlog-agent",children:[]}]},{value:"4 Monitoring indicator configuration instructions",id:"4-monitoring-indicator-configuration-instructions",children:[]}],d={toc:c};function m(e){var t=e.components,l=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"1-overview-of-inlong-agent"},"1 Overview of InLong-Agent"),(0,i.kt)("p",null,"InLong-Agent is a collection tool that supports multiple types of data sources, and is committed to achieving stable and efficient data collection functions between multiple heterogeneous data sources including file, sql, Binlog, metrics, etc."),(0,i.kt)("h3",{id:"11-the-brief-architecture-diagram-is-as-follows"},"1.1 The brief architecture diagram is as follows:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(96570).Z})),(0,i.kt)("h3",{id:"12-design-concept"},"1.2 design concept"),(0,i.kt)("p",null,"In order to solve the problem of data source diversity, InLong-agent abstracts multiple data sources into a unified source concept, and abstracts sinks to write data. When you need to access a new data source, you only need to configure the format and reading parameters of the data source to achieve efficient reading."),(0,i.kt)("h3",{id:"13-current-status-of-use"},"1.3 Current status of use"),(0,i.kt)("p",null,"InLong-Agent is widely used within the Tencent Group, undertaking most of the data collection business, and the amount of online data reaches tens of billions."),(0,i.kt)("h2",{id:"2-inlong-agent-architecture"},"2 InLong-Agent architecture"),(0,i.kt)("p",null,"The InLong Agent task is used as a data acquisition framework, constructed with a channel + plug-in architecture. Read and write the data source into a reader/writer plug-in, and then into the entire framework."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Reader: Reader is the data collection module, responsible for collecting data from the data source and sending the data to the channel."),(0,i.kt)("li",{parentName:"ul"},"Writer: Writer is a data writing module, which reuses data continuously to the channel and writes the data to the destination."),(0,i.kt)("li",{parentName:"ul"},"Channel: The channel used to connect the reader and writer, and as the data transmission channel of the connection, which realizes the function of data reading and monitoring")),(0,i.kt)("h2",{id:"3-different-kinds-of-agent"},"3 Different kinds of agent"),(0,i.kt)("h3",{id:"31-file-agent"},"3.1 file agent"),(0,i.kt)("p",null,"File collection includes the following functions:"),(0,i.kt)("p",null,"User-configured path monitoring, able to monitor the created file information\nDirectory regular filtering, support YYYYMMDD+regular expression path configuration\nBreakpoint retransmission, when InLong-Agent restarts, it can automatically re-read from the last read position to ensure no reread or missed reading."),(0,i.kt)("h3",{id:"32-sql-agent"},"3.2 sql agent"),(0,i.kt)("p",null,"This type of data refers to the way it is executed through SQL\nSQL regular decomposition, converted into multiple SQL statements\nExecute SQL separately, pull the data set, the pull process needs to pay attention to the impact on mysql itself\nThe execution cycle, which is generally executed regularly"),(0,i.kt)("h3",{id:"33-binlog-agent"},"3.3 binlog agent"),(0,i.kt)("p",null,"This type of collection reads binlog and restores data by configuring mysql slave\nNeed to pay attention to multi-threaded parsing when binlog is read, and multi-threaded parsing data needs to be labeled in order\nThe code is based on the old version of dbsync, the main modification is to change the sending of tdbus-sender to push to agent-channel for integration"),(0,i.kt)("h2",{id:"4-monitoring-indicator-configuration-instructions"},"4 Monitoring indicator configuration instructions"),(0,i.kt)("p",null,"Agent provides the ability of monitoring indicators in JMX mode, and the monitoring indicators have been registered to MBeanServer\nUsers can add similar JMX (port and authentication are adjusted according to the situation) to the startup parameters of the Agent to realize the collection of monitoring indicators from the remote end."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-Shell"},"-Dcom.sun.management.jmxremote\n-Djava.rmi.server.hostname=127.0.0.1\n-Dcom.sun.management.jmxremote.port=9999\n-Dcom.sun.management.jmxremote.authenticate=false\n-Dcom.sun.management.jmxremote.ssl=false\n")),(0,i.kt)("p",null,"The agent indicators are divided into the following items, and the indicators are as follows:"),(0,i.kt)("p",null,"AgentTaskMetric"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"property"),(0,i.kt)("th",{parentName:"tr",align:null},"info"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"runningTasks"),(0,i.kt)("td",{parentName:"tr",align:null},"tasks currently being executed")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"retryingTasks"),(0,i.kt)("td",{parentName:"tr",align:null},"Tasks that are currently being retried")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"fatalTasks"),(0,i.kt)("td",{parentName:"tr",align:null},"The total number of currently failed tasks")))),(0,i.kt)("p",null,"JobMetrics"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"property"),(0,i.kt)("th",{parentName:"tr",align:null},"info"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"runningJobs"),(0,i.kt)("td",{parentName:"tr",align:null},"the total number of currently running jobs")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"fatalJobs"),(0,i.kt)("td",{parentName:"tr",align:null},"the total number of currently failed jobs")))),(0,i.kt)("p",null,"PluginMetric"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"property"),(0,i.kt)("th",{parentName:"tr",align:null},"info"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"readNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of reads")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"sendNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of sent items")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"sendFailedNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of failed sending")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"readFailedNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of failed reads")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"readSuccessNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of successful reads")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"sendSuccessNum"),(0,i.kt)("td",{parentName:"tr",align:null},"the number of successfully sent")))))}m.isMDXComponent=!0},96570:function(e,t,n){t.Z=n.p+"assets/images/architecture-4c55eb883104dccdff77e8b8e57f2678.png"}}]);