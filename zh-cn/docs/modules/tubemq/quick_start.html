<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="quick_start" />
	<meta name="description" content="quick_start" />
	<!-- 网页标签标题 -->
	<title>quick_start</title>
	<link rel="shortcut icon" href="/img/apache.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><a href="//www.apache.org"><img class="logo apache" style="width:120px" src="/img/asf_logo.svg"/></a><div class="logo-split"></div><img class="logo tube" style="width:120px;top:12px;position:absolute" src="/img/Tube logo.svg"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><div><ul class="ant-menu blackClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/quick_start.html" target="_self">文档</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/download/download.html" target="_self">下载</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/development/how-to-contribute.html" target="_self">开发</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/apache/incubator-inlong" target="_self">GITHUB</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper">Apache</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div></div><div class="header-background"></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>引导</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/quick_start.html" target="_self">快速开始</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/cookbooks/user_manual.html" target="_self">用户手册</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/example.html" target="_self">入库Hive示例</a></li></ul></li><li class="menu-item menu-item-level-1"><span>组件介绍</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Manager<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/manager/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/manager/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>WebSite<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/website/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Agent<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/agent/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/agent/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>DataProxy<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>DataProxy-SDK<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy-sdk/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy-sdk/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>TubeMQ<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/quick_start.html" target="_self">快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/configure_introduction.html" target="_self">配置参数介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/console_introduction.html" target="_self">管控台操作指引</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/client_rpc.html" target="_self">客户端RPC</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/error_code.html" target="_self">错误码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/deployment.html" target="_self">部署示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/http_access_api.html" target="_self">HTTP API介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/clients_java.html" target="_self">JAVA SDK使用示例</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>TubeMQ-Manager<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/tubemq-manager/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Sort<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/introduction.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/protocol_introduction.html" target="_self">Zookeeper配置介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/quick_start.html" target="_self">编译部署</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span><div class="menu-item menu-item-level-1" style="margin-left:-20px"><a href="/zh-cn/docs/contact.html" target="_self" style="padding-left:20px">联系我们</a></div></span><ul></ul></li></ul></div><div class="doc-content markdown-body"><h2>部署运行</h2>
<h3>1.1 配置示例</h3>
<p>TubeMQ 集群包含有两个组件: <strong>Master</strong> 和 <strong>Broker</strong>. Master 和 Broker 可以部署在相同或者不同的节点上，依照业务对机器的规划进行处理。我们通过如下3台机器搭建有2台Master的生产、消费的集群进行配置示例：</p>
<table>
<thead>
<tr>
<th>所属角色</th>
<th>TCP端口</th>
<th>TLS端口</th>
<th>WEB端口</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master</td>
<td>8099</td>
<td>8199</td>
<td>8080</td>
<td>元数据存储在<code>/stage/meta_data</code></td>
</tr>
<tr>
<td>Broker</td>
<td>8123</td>
<td>8124</td>
<td>8081</td>
<td>消息储存在<code>/stage/msg_data</code></td>
</tr>
<tr>
<td>ZooKeeper</td>
<td>2181</td>
<td></td>
<td></td>
<td>Offset储存在根目录<code>/tubemq</code></td>
</tr>
</tbody>
</table>
<h3>1.2 准备工作</h3>
<ul>
<li>ZooKeeper集群</li>
</ul>
<p>选择安装路径后，安装包解压后的目录结构如下：</p>
<pre><code>/INSTALL_PATH/inlong-tubemq-server/
├── bin
├── conf
├── lib
├── logs
└── resources
</code></pre>
<h3>1.3 配置Master</h3>
<p>编辑<code>conf/master.ini</code>，根据集群信息变更以下配置项</p>
<ul>
<li>Master IP和端口</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[master]</span>
<span class="hljs-attr">hostName</span>=YOUR_SERVER_IP                   // 替换为当前主机IP
<span class="hljs-attr">port</span>=<span class="hljs-number">8099</span>
<span class="hljs-attr">webPort</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">metaDataPath</span>=/stage/meta_data
</code></pre>
<ul>
<li>访问授权Token</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">confModAuthToken</span>=abc                     // 该token用于页面配置、API调用等
</code></pre>
<ul>
<li>ZooKeeper集群地址</li>
</ul>
<pre><code class="language-ini">[zookeeper]                              // 同一个集群里Master和Broker必须使用同一套zookeeper环境，且配置一致
zkNodeRoot=/tubemq
zkServerAddr=localhost:2181              // 指向zookeeper集群，多个地址逗号分开
</code></pre>
<ul>
<li>配置Replication策略</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[replication]</span>
<span class="hljs-attr">repGroupName</span>=tubemqGroup1                // 同一个集群的Master必须要用同一个组名，且不同集群的组名必须不同 
<span class="hljs-attr">repNodeName</span>=tubemqGroupNode1             // 同一个集群的master节点名必须是不同的名称
<span class="hljs-attr">repHelperHost</span>=FIRST_MASTER_NODE_IP:<span class="hljs-number">9001</span>  // helperHost用于创建master集群，一般配置第一个master节点ip
</code></pre>
<ul>
<li>（可选）生产环境，多master HA级别</li>
</ul>
<table>
<thead>
<tr>
<th>HA级别</th>
<th>Master数量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>高</td>
<td>3 masters</td>
<td>任何主节点崩溃后，集群元数据仍处于读/写状态，可以接受新的生产者/消费者。</td>
</tr>
<tr>
<td>中</td>
<td>2 masters</td>
<td>一个主节点崩溃后，集群元数据处于只读状态。对现有的生产者和消费者没有任何影响。</td>
</tr>
<tr>
<td>低</td>
<td>1 master</td>
<td>主节点崩溃后，对现有的生产者和消费者没有影响。</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>：需保证Master所有节点之间的时钟同步</p>
<h3>1.4 配置Broker</h3>
<p>编辑<code>conf/broker.ini</code>，根据集群信息变更以下配置项</p>
<ul>
<li>Broker IP和端口</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[broker]</span>
<span class="hljs-attr">brokerId</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">hostName</span>=YOUR_SERVER_IP                 // 替换为当前主机IP，broker目前只支持IP
<span class="hljs-attr">port</span>=<span class="hljs-number">8123</span>
<span class="hljs-attr">webPort</span>=<span class="hljs-number">8081</span>
</code></pre>
<ul>
<li>Master地址</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">masterAddressList</span>=YOUR_MASTER_IP1:<span class="hljs-number">8099</span>,YOUR_MASTER_IP2:<span class="hljs-number">8099</span>   //多个master以逗号分隔
</code></pre>
<ul>
<li>数据目录</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">primaryPath</span>=/stage/msg_data
</code></pre>
<ul>
<li>ZooKeeper集群地址</li>
</ul>
<pre><code class="language-ini">[zookeeper]                             // 同一个集群里Master和Broker必须使用同一套zookeeper环境，且配置一致
zkNodeRoot=/tubemq                      
zkServerAddr=localhost:2181             // 指向zookeeper集群，多个地址逗号分开
</code></pre>
<h3>1.5 启动Master</h3>
<p>进入Master节点的 <code>bin</code> 目录下，启动服务:</p>
<pre><code class="language-bash">./tubemq.sh master start
</code></pre>
<p>访问Master的管控台 <code>http://YOUR_MASTER_IP:8080</code> ，页面可查则表示master已成功启动:
<img src="img/tubemq-console-gui.png" alt="TubeMQ Console GUI"></p>
<h4>1.5.1 配置Broker元数据</h4>
<p>Broker启动前，首先要在Master上配置Broker元数据，增加Broker相关的管理信息。在<code>Broker List</code> 页面,  <code>Add Single Broker</code>，然后填写相关信息:</p>
<p><img src="img/tubemq-add-broker-1.png" alt="Add Broker 1"></p>
<p>需要填写的内容包括：</p>
<ol>
<li>broker IP: broker server ip</li>
<li>authToken:  <code>conf/master.ini</code> 文件中 <code>confModAuthToken</code> 字段配置的 token</li>
</ol>
<p>然后上线Broker：
<img src="img/tubemq-add-broker-1.png" alt="Add Broker 2"></p>
<h3>1.6 启动Broker</h3>
<p>进入broker节点的 <code>bin</code> 目录下，执行以下命令启动Broker服务：</p>
<pre><code class="language-bash">./tubemq.sh broker start
</code></pre>
<p>刷新页面可以看到 Broker 已经注册，当 <code>当前运行子状态</code> 为 <code>idle</code> 时， 可以增加topic:
<img src="img/tubemq-add-broker-3.png" alt="Add Broker 3"></p>
<h2>3 快速使用</h2>
<h3>3.1 新增 Topic</h3>
<p>可以通过 web GUI 添加 Topic， 在 <code>Topic列表</code>页面添加，需要填写相关信息，比如增加<code>demo</code> topic：
<img src="img/tubemq-add-topic-1.png" alt="Add Topic 1"></p>
<p>然后选择部署 Topic 的 Broker
<img src="img/tubemq-add-topic-5.png" alt="Add Topic 5"></p>
<p>此时 Broker的 <code>可发布</code> 和 <code>可订阅</code> 依旧是灰色的
<img src="img/tubemq-add-topic-6.png" alt="Add Topic 6"></p>
<p>需要在 <code>Broker列表</code>页面重载Broker 配置
<img src="img/tubemq-add-topic-2.png" alt="Add Topic 2"></p>
<p><img src="img/tubemq-add-topic-3.png" alt="Add Topic 3"></p>
<p>之后就可以在页面查看Topic信息。</p>
<p><img src="img/tubemq-add-topic-4.png" alt="Add Topic 4"></p>
<h3>2.2 运行Example</h3>
<p>可以通过上面创建的<code>demo</code> topic来测试集群。</p>
<h4>2.2.1 生产消息</h4>
<p>将 <code>YOUR_MASTER_IP:port</code> 替换为实际的IP和端口，然后运行producer:</p>
<pre><code class="language-bash"><span class="hljs-built_in">cd</span> /INSTALL_PATH/apache-inlong-tubemq-server-[TUBEMQ-VERSION]-bin
./bin/tubemq-producer-test.sh --master-servers YOUR_MASTER_IP1:port,YOUR_MASTER_IP2:port --topicName demo
</code></pre>
<p>如果能观察下如下日志，则表示数据发送成功：
<img src="img/tubemq-send-message.png" alt="Demo 1"></p>
<h4>2.2.2 消费消息</h4>
<p>将 <code>YOUR_MASTER_IP:port</code> 替换为实际的IP和端口，然后运行Consumer:</p>
<pre><code class="language-bash"><span class="hljs-built_in">cd</span> /INSTALL_PATH/apache-inlong-tubemq-server-[TUBEMQ-VERSION]-bin
./bin/tubemq-consumer-test.sh --master-servers YOUR_MASTER_IP1:port,YOUR_MASTER_IP2:port --topicName demo --groupName test_consume
</code></pre>
<p>如果能观察下如下日志，则表示数据被消费者消费到：</p>
<p><img src="img/tubemq-consume-message.png" alt="Demo 2"></p>
<h2>3 结束</h2>
<p>在这里，已经完成了TubeMQ的编译，部署，系统配置，启动，生产和消费。如果需要了解更深入的内容，请查看《TubeMQ HTTP API》里的相关内容，进行相应的配置设置。</p>
<hr>
<p><a href="#top">Back to top</a></p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/incubator-logo.svg"/><div class="cols-container"><div class="col col-24"><p>Apache InLong (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></div><div class="copyright"><span>Copyright © 2019-2020 The Apache Software Foundation. Apache InLong, InLong, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script src="https://buttons.github.io/buttons.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>
