<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="quick_start" />
	<meta name="description" content="quick_start" />
	<!-- 网页标签标题 -->
	<title>quick_start</title>
	<link rel="shortcut icon" href="/img/apache.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><a href="//www.apache.org"><img class="logo apache" style="width:120px" src="/img/asf_logo.svg"/></a><div class="logo-split"></div><img class="logo tube" style="width:120px;top:12px;position:absolute" src="/img/Tube logo.svg"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><div><ul class="ant-menu blackClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/quick_start.html" target="_self">文档</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/download/download.html" target="_self">下载</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/development/how-to-contribute.html" target="_self">开发</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/apache/incubator-inlong" target="_self">GITHUB</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper">Apache</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div></div><div class="header-background"></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>引导</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/quick_start.html" target="_self">快速开始</a></li></ul></li><li class="menu-item menu-item-level-1"><span>组件介绍</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Manager<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/manager/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/manager/user_manual.html" target="_self">管控台操作指引</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/manager/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Agent<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/agent/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/agent/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>DataProxy<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/dataproxy/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>TubeMQ<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/architecture.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/quick_start.html" target="_self">快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/configure_introduction.html" target="_self">配置参数介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/console_introduction.html" target="_self">管控台操作指引</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/client_rpc.html" target="_self">客户端RPC</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/error_code.html" target="_self">错误码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/deployment.html" target="_self">部署示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/http_access_api.html" target="_self">HTTP API介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/clients_java.html" target="_self">JAVA SDK使用示例</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>TubeMQ-Manager<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/tubemq/tubemq-manager/quick_start.html" target="_self">编译部署</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Sort<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/introduction.html" target="_self">架构介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/protocol_introduction.html" target="_self">Zookeeper配置介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/modules/sort/quick_start.html" target="_self">编译部署</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span><div class="menu-item menu-item-level-1" style="margin-left:-20px"><a href="/zh-cn/docs/contact.html" target="_self" style="padding-left:20px">联系我们</a></div></span><ul></ul></li></ul></div><div class="doc-content markdown-body"><h2>一、安装</h2>
<pre><code>环境要求：
java JDK 1.8
Maven 3.6 +

inlong目录下执行命令
mvn clean package -DskipTests

在项目下的agent-release/target里面可以找到tgz安装包
</code></pre>
<h2>二、配置</h2>
<p>agent 支持两种运行模式：本地运行以及线上运行</p>
<h3>2.1 Agent 线上运行相关设置</h3>
<p>线上运行需要从inlong-manager拉取配置，配置conf/agent.properties如下：</p>
<pre><code class="language-ini"><span class="hljs-attr">agent.fetcher.classname</span>=org.apache.inlong.agent.plugin.fetcher.ManagerFetcher (设置任务获取的类名，默认为ManagerFetcher）
<span class="hljs-attr">agent.local.ip</span>=写入本机ip
<span class="hljs-attr">agent.manager.vip.http.host</span>=manager open api host
<span class="hljs-attr">agent.manager.vip.http.port</span>=manager open api port
</code></pre>
<h3>2.2 DataProxy 相关设置</h3>
<p>在agent目录下新建.inlong文件夹，内部新建bid+.local文件，例如设置的发送bid为a, 则新建a.local文件</p>
<p>内部将写入：</p>
<pre><code class="language-ini">{"cluster_id":1,"isInterVisit":1,"size":1,"address": [{"port":写入proxy port,"host":"写入proxy ip"}], "switch":0}
其中cluster_id, isInterVisit，switch为预留字段，请填写默认值
</code></pre>
<h3>2.3 agent本地运行job配置</h3>
<p>如果不使用线上模式，可以使用本地文件新建读取任务
在conf中新建目录jobs，jobs内部vim job1.json：</p>
<p>写入</p>
<pre><code class="language-json">    {

    <span class="hljs-attr">"job"</span>: {
    
    <span class="hljs-attr">"dir"</span>: {
    
    <span class="hljs-attr">"pattern"</span>: <span class="hljs-string">"需要读取的文件路径，可包含正则表达式，例如test/inlong_[0-9]{1}，监听test下创建的新文件"</span>
    
    },
    
    <span class="hljs-attr">"trigger"</span>: <span class="hljs-string">"org.apache.inlong.agent.plugin.trigger.DirectoryTrigger"</span>,
    
    <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
    
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"fileAgentTest"</span>,
    
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"org.apache.inlong.agent.plugin.sources.TextFileSource"</span>,
    
    <span class="hljs-attr">"sink"</span>: <span class="hljs-string">"org.apache.inlong.agent.plugin.sinks.ProxySink"</span>,
    
    <span class="hljs-attr">"channel"</span>: <span class="hljs-string">"org.apache.inlong.agent.plugin.channel.MemoryChannel"</span>
    
    },
    
    <span class="hljs-attr">"proxy"</span>: {
    
      <span class="hljs-attr">"bid"</span>: <span class="hljs-string">"testbid1"</span>, 
      <span class="hljs-attr">"tid"</span>: <span class="hljs-string">"testtid1"</span>

    }
    
    }
</code></pre>
<p>其中各个参数含义为：</p>
<ul>
<li>job.dir.pattern: 配置读取的文件路径，可包含正则表达式</li>
<li>job.trigger: 触发器名称，默认为DirectoryTrigger，功能为监听文件夹下的文件产生事件，任务运行时已有的文件不会读取</li>
<li>job.source: 使用的数据源类型，默认为TextFileSource，读取文本文件</li>
<li>job.sink：使用的写入器类型，默认为ProxySink，发送消息到dataproxy中</li>
<li>proxy.bid: 写入proxy时使用的bid类型</li>
<li>proxy.tid: 写入proxy时使用的tid类型</li>
</ul>
<h3>2.4 实时添加job配置</h3>
<h4>2.4.1 agent.propertities 修改下面两处</h4>
<pre><code class="language-ini"><span class="hljs-comment"># whether enable http service</span>
<span class="hljs-attr">agent.http.enable</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># http default port</span>
<span class="hljs-attr">agent.http.port</span>=可用端口
</code></pre>
<h4>2.4.2 执行如下命令：</h4>
<pre><code class="language-bash">curl --location --request POST <span class="hljs-string">'http://localhost:8018/config/job'</span> \
--header <span class="hljs-string">'Content-Type: application/json'</span> \
--data <span class="hljs-string">'{
"job": {
"dir": {
"path": "",
"pattern": "/data/inlong-agent/test.log"
},
"trigger": "org.apache.inlong.agent.plugin.trigger.DirectoryTrigger",
"id": 1,
"thread": {
"running": {
"core": "4"
}
},
"name": "fileAgentTest",
"source": "org.apache.inlong.agent.plugin.sources.TextFileSource",
"sink": "org.apache.inlong.agent.plugin.sinks.ProxySink",
"channel": "org.apache.inlong.agent.plugin.channel.MemoryChannel"
},
"proxy": {
"bid": "bid10",
"tid": "bid10"
},
"op": "add"
}'</span>
</code></pre>
<pre><code>其中参数分别为：
pattern: 代表读取/data/inlong-agent/test.log文件，需要新建任务后再创建文件
proxy.bid: 代表发送到dataproxy使用的bid
proxy.tid: 代表发送到dataproxy使用的tid
</code></pre>
<h2>三、运行</h2>
<p>解压后如下命令运行</p>
<pre><code class="language-bash">sh agent.sh start
</code></pre>
<h2>四、可支持的路径配置方案</h2>
<pre><code>例如：
/data/inlong-agent/test.log  //代表读取inlong-agent文件夹下的的新增文件test.log
/data/inlong-agent/test[0-9]{1} //代表读取inlong-agent文件夹下的新增文件test后接一个数字结尾
/data/inlong-agent/test //如果test为目录，则代表读取test下的所有新增文件
/data/inlong-agent/^\\d+(\\.\\d+)? // 以一个或多个数字开头,之后可以是.或者一个.或多个数字结尾，?代表可选,可以匹配的实例：&quot;5&quot;, &quot;1.5&quot; 和 &quot;2.21&quot;
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/incubator-logo.svg"/><div class="cols-container"><div class="col col-24"><p>Apache InLong (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></div><div class="copyright"><span>Copyright © 2019-2020 The Apache Software Foundation. Apache InLong, InLong, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script src="https://buttons.github.io/buttons.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>
