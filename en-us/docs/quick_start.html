<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="quick_start" />
	<meta name="description" content="quick_start" />
	<!-- 网页标签标题 -->
	<title>Quick Start - Apache inlong</title>
	<link rel="shortcut icon" href="/img/apache.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><a href="//www.apache.org"><img class="logo apache" style="width:120px" src="/img/asf_logo.svg"/></a><div class="logo-split"></div><a href=""></a><img class="logo tube" style="width:72px" src="/img/Tube logo.svg"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><div><ul class="ant-menu blackClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/index.html" target="_self">HOME</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/docs/quick_start.html" target="_self">DOCS</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/docs/download/download.html" target="_self">DOWNLOAD</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/docs/development/how-to-contribute.html" target="_self">DEVELOPMENT</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/apache/incubator-inlong" target="_self">GITHUB</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper">Apache</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div></div><div class="header-background"></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>Documentation</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>User Guide</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/quick_start.html" target="_self">Quick Start</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/producer_example.html" target="_self">Producer Example</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/consumer_example.html" target="_self">Consumer Example</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Architecture &amp; Principle</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/architecture.html" target="_self">Architecture</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/client_rpc.html" target="_self">Client RPC</a></li></ul></li><li class="menu-item menu-item-level-1"><span>User Manual</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/deployment.html" target="_self">Deployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/configure_introduction.html" target="_self">Configure Introduction</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/console_introduction.html" target="_self">Console Introduction</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/error_code.html" target="_self">Error Code</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>API Introduction<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/http_access_api.html" target="_self">HTTP API</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/clients_java.html" target="_self">JAVA SDK API</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span><div class="menu-item menu-item-level-1" style="margin-left:-20px"><a href="/en-us/docs/contact.html" target="_self" style="padding-left:20px">Contact Us</a></div></span><ul></ul></li></ul></div><div class="doc-content markdown-body"><h2>Build inlong</h2>
<h3>Prerequisites</h3>
<ul>
<li>Java JDK 1.7 or 1.8</li>
<li>Maven 3.3+</li>
</ul>
<h3>Build Distribution Tarball</h3>
<ul>
<li>Compile and Package</li>
</ul>
<pre><code class="language-bash">mvn clean package -DskipTests
</code></pre>
<ul>
<li>(Optional) Build Using Docker：</li>
</ul>
<pre><code class="language-bash">docker run -v REPLACE_WITH_SOURCE_PATH:/inlong  apacheinlong/inlong-build clean package -DskipTests
</code></pre>
<ul>
<li>Run Unit Tests：</li>
</ul>
<pre><code class="language-bash">mvn <span class="hljs-built_in">test</span>
</code></pre>
<ul>
<li>Build Individual Module：</li>
</ul>
<pre><code class="language-bash">mvn clean install
<span class="hljs-built_in">cd</span> module-name (e.g. inlong-client)
mvn <span class="hljs-built_in">test</span>
</code></pre>
<p>After the build, please go to <code>inlong-server/target</code>. You can find the
<strong>inlong-server-[inlong-VERSION]-bin.tar.gz</strong> file. It is the inlong deployment package, which includes
scripts, configuration files, dependency jars and web GUI code.</p>
<h3>Setting Up Your IDE</h3>
<p>If you want to build and debug source code in IDE, go to the project root, and run</p>
<pre><code class="language-bash">mvn compile
</code></pre>
<p>This command will generate the Java source files from the <code>protoc</code> files, the generated files located in <code>target/generated-sources</code>.</p>
<p>(Optional) If you want to use local <code>protoc</code> executable, you can change the configuration of <code>protobuf-maven-plugin</code> in <code>inlong-core/pom.xml</code> as below</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/generated-sources/java<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">protocExecutable</span>&gt;</span>/usr/local/bin/protoc<span class="hljs-tag">&lt;/<span class="hljs-name">protocExecutable</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h2>Deploy and Start</h2>
<h3>Deploy inlong Standalone</h3>
<p>Standalone mode starts zookeeper/master/broker services in one docker container：</p>
<pre><code>docker run -p 8080:8080 -p 8000:8000 -p 8123:8123 --name inlong -d apacheinlong/inlong-all:latest
</code></pre>
<p>Afater container is running, you can access <code>http://127.0.0.1:8080</code>, and reference to next <code>Quick Start</code> chapter for experience.</p>
<p><strong>Tips</strong>：Standalone Mode is only available for development and experience, it's not designed for production environment.</p>
<h3>Deploy inlong Cluster</h3>
<h4>Prerequisites</h4>
<ul>
<li>ZooKeeper Cluster</li>
<li><a href="download/download.md">inlong-server-[inlong-VERSION]-bin.tar.gz</a> package file</li>
</ul>
<p>After you extract the package file, here's the folder structure.</p>
<pre><code>/INSTALL_PATH/inlong-server-[inlong-VERSION]-bin/
├── bin
├── conf
├── lib
├── logs
└── resources
</code></pre>
<h4>Configuration Example</h4>
<p>There're two components in the cluster: <strong>Master</strong> and <strong>Broker</strong>. Master and Broker
can be deployed on the same server or different servers. In this example, we setup our cluster
like this, and all services run on the same node. Zookeeper should be setup in your environment also.</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>TCP Port</th>
<th>TLS Port</th>
<th>Web Port</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master</td>
<td>8099</td>
<td>8199</td>
<td>8080</td>
<td>Meta data is stored at /stage/metadata</td>
</tr>
<tr>
<td>Broker</td>
<td>8123</td>
<td>8124</td>
<td>8081</td>
<td>Message is stored at /stage/msgdata</td>
</tr>
<tr>
<td>Zookeeper</td>
<td>2181</td>
<td></td>
<td></td>
<td>Offset is stored at /inlong</td>
</tr>
</tbody>
</table>
<h4>Configure Master</h4>
<p>You can change configurations in <code>conf/master.ini</code> according to cluster information.</p>
<ul>
<li>Master IP and Port</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[master]</span>
<span class="hljs-attr">hostName</span>=YOUR_SERVER_IP                  // replaced with your server IP
<span class="hljs-attr">port</span>=<span class="hljs-number">8000</span>
<span class="hljs-attr">webPort</span>=<span class="hljs-number">8080</span>
</code></pre>
<ul>
<li>Access Authorization Token</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">confModAuthToken</span>=abc                    // for configuring Web Resources\API etc
</code></pre>
<ul>
<li>ZooKeeper Cluster</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[zookeeper]</span>
<span class="hljs-attr">zkNodeRoot</span>=/inlong
<span class="hljs-attr">zkServerAddr</span>=localhost:<span class="hljs-number">2181</span>             // multi zookeeper addresses can separate with <span class="hljs-string">","</span>
</code></pre>
<ul>
<li>Replication Strategy</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[replication]</span>
<span class="hljs-attr">repNodeName</span>=inlongMasterGroupNode1       // using different name for each master node
<span class="hljs-attr">repHelperHost</span>=FIRST_MASTER_NODE_IP:<span class="hljs-number">9001</span>  // helperHost is used for building HA master.
</code></pre>
<ul>
<li>Resource Path of Web</li>
</ul>
<p>You can change configurations in <code>resources/velocity.properties</code></p>
<pre><code class="language-properties"><span class="hljs-meta">file.resource.loader.path</span>=<span class="hljs-string">/INSTALL_PATH/inlong-server-[inlong-VERSION]-bin/resources/templates</span>
</code></pre>
<ul>
<li>(Optional) Master High Availability</li>
</ul>
<p>In the example above, we run the services on a single node. However, in real production environment, you
need to run multiple master services on different servers for high availability purpose. Here's
the introduction of availability level.</p>
<table>
<thead>
<tr>
<th>HA Level</th>
<th>Master Number</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>High</td>
<td>3 masters</td>
<td>After any master crashed, the cluster meta data is still in read/write state and can accept new producers/consumers.</td>
</tr>
<tr>
<td>Medium</td>
<td>2 masters</td>
<td>After one master crashed, the cluster meta data is in read only state. There's no affect on existing producers and consumers.</td>
</tr>
<tr>
<td>Minimum</td>
<td>1 master</td>
<td>After the master crashed, there's no affect on existing producer and consumer.</td>
</tr>
</tbody>
</table>
<p><strong>Tips</strong>：Please notice that the master servers should be clock synchronized.</p>
<h4>Configure Broker</h4>
<p>You can change configurations in <code>conf/broker.ini</code> according to cluster information.</p>
<ul>
<li>Broker IP and Port</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[broker]</span>
<span class="hljs-attr">brokerId</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">hostName</span>=YOUR_SERVER_IP                 // replaced with your server IP
<span class="hljs-attr">port</span>=<span class="hljs-number">8123</span>
<span class="hljs-attr">webPort</span>=<span class="hljs-number">8081</span>
</code></pre>
<ul>
<li>Master Address</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">masterAddressList</span>=MASTER_NODE_IP:<span class="hljs-number">8000</span>   // multi addresses can separate with <span class="hljs-string">","</span>
</code></pre>
<ul>
<li>Metadata Path</li>
</ul>
<pre><code class="language-ini"><span class="hljs-attr">primaryPath</span>=/stage/msgdata
</code></pre>
<ul>
<li>ZooKeeper Cluster</li>
</ul>
<pre><code class="language-ini"><span class="hljs-section">[zookeeper]</span>
<span class="hljs-attr">zkNodeRoot</span>=/inlong
<span class="hljs-attr">zkServerAddr</span>=localhost:<span class="hljs-number">2181</span>             // multi zookeeper addresses can separate with <span class="hljs-string">","</span>
</code></pre>
<h4>Start Master</h4>
<p>Please go to the <code>bin</code> folder and run this command to start
the master service.</p>
<pre><code class="language-bash">./inlong master start
</code></pre>
<p>You should be able to access <code>http://your-master-ip:8080</code> to see the
web GUI now.</p>
<p><img src="img/inlong-console-gui.png" alt="inlong Console GUI"></p>
<h4>Configure Broker Metadata</h4>
<p>Before we start a broker service, we need to configure it on master web GUI first.</p>
<p>Go to the <code>Broker List</code> page, click <code>Add Single Broker</code>, and input the new broker
information.</p>
<p><img src="img/inlong-add-broker-1.png" alt="Add Broker 1"></p>
<p>In this example, we only need to input broker IP and authToken:</p>
<ol>
<li>broker IP: broker server ip</li>
<li>authToken: A token pre-configured in the <code>conf/master.ini</code> file. Please check the
<code>confModAuthToken</code> field in your <code>master.ini</code> file.</li>
</ol>
<p>Click the online link to activate the new added broker.</p>
<p><img src="img/inlong-add-broker-2.png" alt="Add Broker 2"></p>
<h4>Start Broker</h4>
<p>Please go to the <code>bin</code> folder and run this command to start the broker service</p>
<pre><code class="language-bash">./inlong broker start
</code></pre>
<p>Refresh the GUI broker list page, you can see that the broker now is registered.</p>
<p>After the sub-state of the broker changed to <code>idle</code>, we can add topics to that broker.</p>
<p><img src="img/inlong-add-broker-3.png" alt="Add Broker 3"></p>
<h2>Quick Start</h2>
<h3>Add Topic</h3>
<p>We can add or manage the cluster topics on the web GUI. To add a new topic, go to the
topic list page and click the add new topic button</p>
<p><img src="img/inlong-add-topic-1.png" alt="Add Topic 1"></p>
<p>Then select the brokers which you want to deploy the topics to.</p>
<p><img src="img/inlong-add-topic-5.png" alt="Add Topic 5"></p>
<p>We can see the publish and subscribe state of the new added topic is still grey. We need
to go to the broker list page to reload the broker configuration.</p>
<p><img src="img/inlong-add-topic-6.png" alt="Add Topic 6"></p>
<p><img src="img/inlong-add-topic-2.png" alt="Add Topic 2"></p>
<p>When the broker sub-state changed to idle, go to the topic list page. We can see
that the topic publish/subscribe state is active now.</p>
<p><img src="img/inlong-add-topic-3.png" alt="Add Topic 3"></p>
<p><img src="img/inlong-add-topic-4.png" alt="Add Topic 4"></p>
<p>Now we can use the topic to send messages.</p>
<h3>Run Example</h3>
<p>Now we can use <code>demo</code> topic which created before to test our cluster.</p>
<ul>
<li>Produce Messages</li>
</ul>
<p>Please don't forget replace <code>YOUR_MASTER_IP</code> with your server ip, and start producer.</p>
<pre><code class="language-bash">install_path=/INSTALL_PATH/inlong-server-[inlong-VERSION]-bin
java -Dlog4j.configuration=file:<span class="hljs-variable">${install_path}</span>/conf/tools.log4j.properties  \
-Djava.net.preferIPv4Stack=<span class="hljs-literal">true</span> -cp  <span class="hljs-variable">${install_path}</span>/lib/*:<span class="hljs-variable">${install_path}</span>/conf/* \
org.apache.inlong.example.MessageProducerExample \
YOUR_MASTER_IP:8000 demo 100000
</code></pre>
<p>From the log, we can see the message is sent out.</p>
<pre><code class="language-bash">[2020-06-04 11:19:04,405] INFO Send demo 1000 message, keyCount is 252 (org.apache.inlong.example.MessageProducerExample)
[2020-06-04 11:19:04,652] INFO Send demo 2000 message, keyCount is 502 (org.apache.inlong.example.MessageProducerExample)
[2020-06-04 11:19:05,096] INFO Send demo 3000 message, keyCount is 752 (org.apache.inlong.example.MessageProducerExample)
[2020-06-04 11:19:05,181] INFO Send demo 4000 message, keyCount is 1002 (org.apache.inlong.example.MessageProducerExample)
</code></pre>
<ul>
<li>Consume Messages</li>
</ul>
<p>Please don't forget replace YOUR_MASTER_IP with your server ip, and start consumer.</p>
<pre><code class="language-bash">java -Xmx512m -Dlog4j.configuration=file:/opt/inlong-server/conf/tools.log4j.properties \
-Djava.net.preferIPv4Stack=<span class="hljs-literal">true</span> -cp /opt/inlong-server/lib/*:/opt/inlong-server/conf/* \
org.apache.inlong.example.MessageConsumerExample \
YOUR_SERVER_IP:8000 demo demoGroup 3 1 1
</code></pre>
<p>From the log, we can see the message received by the consumer.</p>
<pre><code class="language-bash">[2020-06-04 11:20:29,107] INFO Receive messages:270000 (org.apache.inlong.example.MsgRecvStats)
[2020-06-04 11:20:31,206] INFO Receive messages:272500 (org.apache.inlong.example.MsgRecvStats)
[2020-06-04 11:20:31,590] INFO Receive messages:275000 (org.apache.inlong.example.MsgRecvStats)
[2020-06-04 11:20:31,910] INFO Receive messages:277500 (org.apache.inlong.example.MsgRecvStats)
</code></pre>
<hr>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/incubator-logo.svg"/><div class="cols-container"><div class="col col-24"><p>Apache inlong (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></div><div class="copyright"><span>Copyright © 2019-2020 The Apache Software Foundation. Apache inlong, inlong, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script src="https://buttons.github.io/buttons.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>
